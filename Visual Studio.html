<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=cp936">
    <title>Visual Studio</title>
    <link rel="stylesheet" type="text/css" href="css/shCoreDefault.css"/>
    <link rel="Stylesheet" type="text/css" href="static/css/wiki.css">
    <link rel="Stylesheet" type="text/css" href="static/bootstrap/css/bootstrap.min.css">
    <script type="text/javascript" src="static/js/jquery.min.js"></script>
    <script type="text/javascript" src="static/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/js/wiki.js"></script>
    <script type="text/javascript" src="static/js/shCore.js"></script>
    <script type="text/javascript" src="static/js/shBrushPython.js"></script>
    <script type="text/javascript" src="static/js/shBrushCpp.js"></script>
    <script type="text/javascript" src="static/js/shBrushErlang.js"></script>
    <script type="text/javascript" src="static/js/shBrushBash.js"></script>
    <script type="text/javascript" src="static/js/shBrushRuby.js"></script>
    <script type="text/javascript" src="static/js/shBrushSql.js"></script>
    <script type="text/javascript" src="static/js/shBrushJScript.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<nav class="navbar navbar-default navbar-inverse" role="navigation">
 <div class="container">
    <div class="navbar-header">
<button data-target=".bs-navbar-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
	<span class="sr-only"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
      </button>
	<a class="navbar-brand" href="main.html">Rick's wiki</a>
    </div>
    <div class="collapse navbar-collapse">
	<ul class="nav navbar-nav">
	    <li><a href="main.html">Home</a></li>
	    <li><a href="TODO.html">TODO</a></li>
	</ul>
    </div>
 </div>
</nav>
<div class="container content-body">
    
<div class="toc">
<ul>
<li><a href="#toc_0.1">Short Cut</a>
<li><a href="#toc_0.2">VC C++</a>
<li><a href="#toc_0.3">VS集成Qt环境搭建</a>
<li><a href="#toc_0.4">VC</a>
<li><a href="#toc_0.5">VC#</a>
</ul>
</ul>
</div>

<h2 id="toc_0.1">Short Cut</h2>
<ul>
<li>
  shift + Alt + Enter     全屏切换

<li>
  Ctrl+D                  设置控件焦点， MFC做图时有用

</ul>

<h2 id="toc_0.2">VC C++</h2>
<ul>
<li>
  #pragma是C++中最复杂的预处理指令，下面是最常用的几个#pragma指令：

<ul>
<li>
#pragma comment(lib,"XXX.lib")    表示链接XXX.lib这个库，和在工程设置里写上XXX.lib的效果一样。

<li>
#pragma comment(linker,"/ENTRY:main_function")    表示指定链接器选项/ENTRY:main_function

<li>
#pragma once  表示这个文件只被包含一次, 它是基于磁盘文件的，而#ifndef则是基于宏的。

<li>
#pragma warning(disable:4705)     表示屏蔽警告4705 

<ul>
<li>
  #pragma warning(disable:4507 34) // 不显示4507和34号警告信息   

<li>
  #pragma warning(once:4385)       // 4385号警告信息仅报告一次   

<li>
  #pragma warning(error:164)       // 把164号警告信息作为一个错误

<li>
  #pragma warning(default:176)     // 重置编译器的176号警告行为到默认状态  

</ul>
<li>
#pragma pack(push, n)     将当前字节对齐方式放入到内部编译器栈中，并将当前的内存对齐方式设置为4 

<li>
#pragma pack(pop)         将内部编译器栈顶的记录弹出，并将其作为当前的内存对齐方式€?€?

<li>
#pragma alloc_text        编译时控制分页能力

<ul>
<li>
  #pragma alloc_text(INIT, DriverEntry)           如果某些代码在驱动程序完成初始化后不再需要，可以直接把它插入到INIT段

<li>
  #pragma alloc_text(PAGE, a)                     表示函数a运行在分页内存中

</ul>
</ul>
</ul>

<h2 id="toc_0.3">VS集成Qt环境搭建</h2>
<ul>
<li>
  <a href="http://blog.sina.com.cn/s/blog_a6fb6cc90101gynd.html">http://blog.sina.com.cn/s/blog_a6fb6cc90101gynd.html</a>

<li>
  下载Qt5.*安装包（qt-windows-opensource）与Qt插件（Visual Studio Add-in）

<li>
  配置开发环境

<ul>
<li>
  选择：Qt5-&gt;Qt Options-&gt;Add，配置VS的开发环境。

</ul>
<li>
  添加环境变量, 否则丢失*.dll的提示信息

<ul>
<li>
  右键计算机-&gt;属性-&gt;高级系统设置-&gt;高级-&gt;环境变量，添加环境变量（推荐）

<li>
  QTDIR：D:\Software\Qt\Qt5.5.0\5.5\msvc2013

<li>
  PATH：%QTDIR%\bin

</ul>
<li>
  编码时， 找不到QT的内容

<ul>
<li>
  Assist的Option中， C/C++ 选项 -&gt; Customer -&gt; other include -&gt; 包含QT的Include， 然后重启即可

</ul>
</ul>

<h2 id="toc_0.4">VC</h2>
<ul>
<li>
  VC编译连接选项  <a href="http://www.cnblogs.com/skyofbitbit/p/3649819.html">http://www.cnblogs.com/skyofbitbit/p/3649819.html</a>

<li>
  <a href="Query Register and Convert 64 int to String.html">Query Register and Convert 64 int to String</a>

<li>
  <a href="file operation in kernal mode.html">file operation in kernal mode</a>

<li>
  <a href="http://msdn.microsoft.com/en-us/library/aa363765(v=vs.85).aspx">file operation in user mode</a>

<li>
  <a href="Wrinte DLL using VS.html">Wrinte DLL using VS</a>

<li>
  VS2012 Config

<ul>
<li>
  Turn off Unicode in VC++ Project

<ul>
<li>
  Project Properties -&gt; General -&gt; Project Defaults -&gt; <strong>Character Set</strong>

</ul>
<li>
  .sdf and ipch

<ul>
<li>
  Visual Studio用来保存预编译的头文件和Intellisense用的

<li>
  不在当前工程中生成这些文件, VS用临时文件夹保存这些文件
<pre>
            Tools-&gt;Options  Text Editor -&gt; C/C++ -&gt; Advanced
            Fallback Location:  Always use Fallback Location -&gt; Set True
                                Do Not Warn if Fallback Location Used  -&gt; Set True
</pre>

</ul>
</ul>
<li>
  Extensions:     Tools -&gt; Extensions and Updates...

<ul>
<li>
  <a href="https://github.com/jaredpar/VsVim">VsVim</a> vim extension in VS2012

<ul>
<li>
  Options... -&gt; VsVim -&gt; Config Key mappings

<li>
  :set vimrc          -&gt; Show the vimrc which VsVim read

</ul>
<li>
  Productivity Power Tools

<ul>
<li>
  Enhanced scroll bar(full bar mode)

</ul>
<li>
  Visual Studio Color Theme Editor

<ul>
<li>
  Dark Theme

</ul>
<li>
  Visual Assist

<li>
  Visual HG       good enough

<ul>
<li>
  需要在工程文件夹上先创建Repository， 再打开VS2012工程， 添加文件并Commit

</ul>
<li>
  HgSccPackage

<ul>
<li>
  Hg source control

<li>
  <a href="https://bitbucket.org/zzsergant/hgsccpackage/wiki/configVS">https://bitbucket.org/zzsergant/hgsccpackage/wiki/configVS</a>

</ul>
</ul>
<li>
  VS2012 静态编译c c++运行库

<ul>
<li>
  Win8上编译的程序在Win7上有可能不能运行，原因是它们使用的C运行库不一样，好的解决方法是在编译时将运行库编译进程序，随程序一起发布

<li>
  在VS2012中修改设置：Project Property-&gt;Configuration Properties-&gt;C/C++-&gt;Code Generation-&gt;Runtime Library-&gt;修改选项为"Mutiple-threaded(/MT)"

</ul>
<li>
  VS里面非常好用的功能，在build之前或之后可以完成一些动作，比如文件Copy，但是在Copy时注意命令的写法：(nonpnp sample in e:\work\sampledriver)
<pre>
        //不能想当然的写相对路径，要使用VS定义的宏来指明路径，在调用该cmd时会解析成完整路径
        Error   copy "..\..\wdf\x86\WdfCoInstaller01011.dll" ".\bin"
        Right   copy "$(SolutionDir)..\..\wdf\x86\WdfCoInstaller01011.dll" "$(SolutionDir)bin\"
</pre>

<li>
  Dump中可以看到完整的Driver信息

<ul>
<li>
  在Win7上编译代码时，在sources文件中添加 LINKER_FLAGS=$(LINKER_FLAGS) /SECTION:.rsrc,!D

<li>
  在Win8 VS2012中, 在Project-&gt;Property Pages-&gt;Links-&gt;All Options-&gt;Specify Section Attributes：  .rsrc,!D

<li>
  在Dump中的对比效果如下, 可以看到更多的信息，主要是FileVersion
<pre>
        0: kd&gt; lmvm RtkBtfilter
        start    end        module name
        bacb1000 bad3e000   RtkBtfilter   (private pdb symbols)  E:\SVNWorkspace\trunk\HostSW\win7-inbox-driver\RtkFilter\generic\RtDFilter_Win8\Win8Release\x86\RtkBtfilter.pdb
            Loaded symbol image file: RtkBtfilter.sys
            Image path: \SystemRoot\system32\DRIVERS\RtkBtfilter.sys
            Image name: RtkBtfilter.sys
            Timestamp:        Wed Apr 09 18:43:55 2014 (5345246B)
            CheckSum:         00078075
            ImageSize:        0008D000
            File version:     1.3.814.0
            Product version:  1.3.814.0
            File flags:       8 (Mask 3F) Private
            File OS:          40004 NT Win32
            File type:        3.7 Driver
            File date:        00000000.00000000
            Translations:     0000.04b0
            CompanyName:      Realtek Semiconductor Corporation
            ProductName:      Bluetooth Software
            InternalName:     RtkBtfilter.sys
            OriginalFilename: RtkBtfilter.sys
            ProductVersion:   1.3.814.0
            FileVersion:      1.3.814.0
            FileDescription:  Realtek Bluetooth Filter Driver
            LegalCopyright:   Realtek All Rights Reserved



        0: kd&gt; lmvm RtkBtfilter
        Browse full module list
        start             end                 module name
        fffff880`0a4fc000 fffff880`0a598000   RtkBtfilter   (no symbols)           
            Loaded symbol image file: RtkBtfilter.sys
            Image path: \SystemRoot\system32\DRIVERS\RtkBtfilter.sys
            Image name: RtkBtfilter.sys
            Browse all global symbols  functions  data
            Timestamp:        Tue Apr 01 14:05:52 2014 (533A5740)
            CheckSum:         000897C8
            ImageSize:        0009C000
            Translations:     0000.04b0 0000.04e4 0409.04b0 0409.04e4
</pre>

<li>
  右键点击sys档-&gt;属性-&gt;Details，可以看到一些Descriptions, 说明在image中有一个properly-formatted VERSIONINFO

</ul>
</ul>
<p>
section, 在img被装载到内存时，该section不一定会存在（被paged out或被discarded），所以lmvm不能显示出完整的信息
</p>
<ul>
<li>
  如果在link时指明.rsrc section为non-discarded, 则该resource section就会被认为是non-paged, 我们在dump中就可以看到与Details中显示的一样的信息

<li>
  <a href="http://microsoft.public.windbg.narkive.com/2L9U1zB7/driver-version-w-lm-v">http://microsoft.public.windbg.narkive.com/2L9U1zB7/driver-version-w-lm-v</a>

</ul>
<li>
  <a href="http://vld.codeplex.com/">Visual Leak Detector</a>

<ul>
<li>
  下载安装程序安装

<li>
  在程序中的.c文件包含#include "vld"

<li>
  编译Debug版并运行，如果有Memory Leak则会自动检测出来且还有内存分配时的栈信息   

<li>
  没有试过Driver中是否有用

</ul>
<li>
  VS2012 输出目录

<ul>
<li>
  Property Pages-&gt;Configuration Properties-&gt;General: Output Directory //这里可以指定一个全局变量OutDir, 后面在指定输出时可直接引用$(OutDir)

<li>
  Property Pages-&gt;Configuration Properties-&gt;General: Intermediate Directory //中间目录， Build时产生的临时文件， 没什么用

<li>
  Property Pages-&gt;Configuration Properties-&gt;Linker-&gt;General: Output File ==&gt; $(OutDir)rtsocket.dll    //指定要生成文件的名字及存放的目录

<li>
  Property Pages-&gt;Configuration Properties-&gt;Linker-&gt;Debugging: Generate Program Database File ==&gt; $(OutDir)rtsocket.pdb   //指定PDB文件名字及存放目录， 一般要与上面的相同

<li>
  Property Pages-&gt;Configuration Properties-&gt;Linker-&gt;Advanced: Import Library ==&gt; $(OutDir)rtsocket.lib    //指定导入库文件的名字及目录， 一般要上面相同

</ul>
<li>
  在Driver中显示Build信息

<ul>
<li>
  DriverEntry：   TraceEvents(TRACE_LEVEL_INFORMATION, DBG_INIT,("Built on %s %s\n", _<em>DATE</em>_, _<em>TIME</em>_));

<li>
  Property Pages -&gt; Driver Module Settings -&gt; General -&gt; Allow Data, time and Timestamp ==&gt; Yes

<li>
  More Settings:  <a href="http://blog.csdn.net/hxybiseng/article/details/8568132">http://blog.csdn.net/hxybiseng/article/details/8568132</a>

</ul>
<li>
  error MSB6006: "tracewpp.exe" exited with code 2

<ul>
<li>
  解决方法， 编辑osrusbfx2.vcxproj文件， 将其中的WppEnabled项设置为false，然后重新加载项目即可

<li>
  vcxproj文件中保存了编译链接的所有信息， 有出现类似问题可以查看该文件

</ul>

<h2 id="toc_0.5">VC#</h2>
<ul>
<li>
  <a href="http://www.nuget.org/">NuGet</a>   the package manager for the Microsoft development platform including .NET

<li>
  <a href="http://wpftoolkit.codeplex.com/">Extended wpf toolkit</a>

<ul>
<li>
  It is the number one collection of WPF controls, components and utilities for creating next generation Windows applications. 

<li>
  Use it to build professional looking, modern, and easy to use line of business applications.

</ul>
</ul>


   <hr />
   <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'rickhuang'; // required: replace example with your forum shortname

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</body>
</html>
