<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=cp936">
    <title>USB</title>
    <link rel="stylesheet" type="text/css" href="css/shCoreDefault.css"/>
    <link rel="Stylesheet" type="text/css" href="static/css/wiki.css">
    <link rel="Stylesheet" type="text/css" href="static/bootstrap/css/bootstrap.min.css">
    <script type="text/javascript" src="static/js/jquery.min.js"></script>
    <script type="text/javascript" src="static/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/js/wiki.js"></script>
    <script type="text/javascript" src="static/js/shCore.js"></script>
    <script type="text/javascript" src="static/js/shBrushPython.js"></script>
    <script type="text/javascript" src="static/js/shBrushCpp.js"></script>
    <script type="text/javascript" src="static/js/shBrushErlang.js"></script>
    <script type="text/javascript" src="static/js/shBrushBash.js"></script>
    <script type="text/javascript" src="static/js/shBrushRuby.js"></script>
    <script type="text/javascript" src="static/js/shBrushSql.js"></script>
    <script type="text/javascript" src="static/js/shBrushJScript.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<nav class="navbar navbar-default navbar-inverse" role="navigation">
 <div class="container">
    <div class="navbar-header">
<button data-target=".bs-navbar-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
	<span class="sr-only"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
      </button>
	<a class="navbar-brand" href="main.html">Rick's wiki</a>
    </div>
    <div class="collapse navbar-collapse">
	<ul class="nav navbar-nav">
	    <li><a href="main.html">Home</a></li>
	    <li><a href="TODO.html">TODO</a></li>
	</ul>
    </div>
 </div>
</nav>
<div class="container content-body">
    
<div class="toc">
<ul>
<li><a href="#toc_0.1">USB</a>
<ul>
<li><a href="#toc_0.1.1">Tools</a>
<li><a href="#toc_0.1.2">Doc</a>
<li><a href="#toc_0.1.3">USB Spec</a>
</ul>
<li><a href="#toc_0.2">Unknown</a>
</ul>
</ul>
</div>
<h2 id="toc_0.1">USB</h2>
<h3 id="toc_0.1.1">Tools</h3>
<ul>
<li>
  CATC

<ul>
<li>
  SOF(Start of frame), 每一个Frame指的是段固定的时间间隔，在该间隔内，Control先发，然后Sync，最后才是Bulk

<li>
  SOF是每个Frame的开始也是上一个Frame的结束，可以Hide SOF

<li>
  XFR，可以将显示的Transfer级的，可将USB的命令解析出来

<li>
  在打开LeCroy USB Protocol Suite后，要设置Setup-&gt;Recording Options-&gt;选择Manual Trigger， BufferSize设为最大

<li>
  每个packet

</ul>
</ul>
<h3 id="toc_0.1.2">Doc</h3>
<ul>
<li>
  <a href="http://blogs.msdn.com/b/usbcoreblog/archive/2011/05/11/demystifying-usb-selective-suspend.aspx">Demystifying USB Selective Suspend</a>

<li>
  <a href="http://wiki.osdev.org/Universal_Serial_Bus">USB Tutorial</a>

</ul>
 
<h3 id="toc_0.1.3">USB Spec</h3>
<ul>
<li>
  USB Speed       ==&gt;   Hubs isolate high-speed signaling from full-/low-speed

<ul>
<li>
  high-speed signaling at 480 Mb/s    (usb2.0)

<li>
  full-speed signaling at 12.0 Mb/s   (usb1.1)

<li>
  low-speed signaling at 1.5 Mb/s     (usb1.1)

</ul>
</ul>
<p>
signaling environments 
</p>
<ul>
<li>
  USB Frames and Microframes

<ul>
<li>
  USB establishes a 1 millisecond time base called a frame on a full-/low-speed bus and a 125??s time base called a microframe on a high-speed bus. 

<li>
  A (micro)frame can contain several transactions.  

</ul>
<li>
  USB Transfer types

<ul>
<li>
  Control Transfers:  Bursty, non-periodic, host software-initiated request/response communication, typically used for command/status operations.

<li>
  Isochronous Transfers:  Periodic, continuous communication between host and device, typically used for time-relevant information. 

<li>
  Interrupt Transfers:  Low-frequency, bounded-latency communication.

<li>
  Bulk Transfers:  Non-periodic, large-packet bursty communication, typically used for data that can use any available bandwidth and can also be delayed until bandwidth is available.

</ul>
<li>
  USB Data Format

<ul>
<li>
  Sync Field: All packets begin with a synchronization (SYNC) field, A SYNC from an initial transmitter is defined to be eight bits in length for full/low-speed and 32 bits

</ul>
</ul>
<p>
for high-speed
</p>
<ul>
<li>
  Packet Field Formats

<ul>
<li>
  Field formats for the token, data, and handshake packets  

<li>
  PID(Packet Identifier Field): follows SYNC field, consists of four-bit packet type field followed by a four-bit check field
<pre>
        PID Type    PID Name    PID     Description
        Tocken      OUT         0001
                    IN          1001
                    SOF         0101
                    SETUP       1101
        Data        DATA0       0011
                    DATA1       1011
                    DATA2       0111
                    MDATA       1111
        Handshake   ACK         0010
                    NAK         1010
                    STALL       1110
                    NYET        0110
        Special     PRE         1100
                    ERR         1100
                    SPLIT       1000
                    PING        0100
                    Reserved    0000
</pre>

<li>
  Address Fields, Function endpoints are addressed using two fields:

<ul>
<li>
  Address Field

<li>
  Endpoint Field

</ul>
<li>
  Frame Number Field  ???????l?????????

<ul>
<li>
  only sent in SOF tokens at the start of each (micro)frame

</ul>
<li>
  Data Field

<ul>
<li>
  range from zero to 1024 bytes

</ul>
<li>
  CRC, protect all non-PID fields in token and data packets for all single- and double-bit errors

<ul>
<li>
  Token CRCs

<li>
  Data CRCs

</ul>
</ul>
<li>
  Packet Formats

<ul>
<li>
  SOP(start of packet)
<pre>
            //  FS/LS
            each packet begins with a synchronization sequence of 8-bits

            // HS
            each packet begins with a synchronization sequence of 32-bits
</pre>

<li>
  EOP(end of packet)
<pre>
            //  FS/LS
            eop is signaled by SE0

            // HS   ？？？
            eop sequence is 8bits long
</pre>

<li>
  Token Packets

<ul>
<li>
  A token consists of a PID, specifying either IN, OUT, or SETUP packet type and ADDR and ENDP fields. 
<pre>
            Field   PID     ADDR    ENDP    CRC5
            Bits    8       7       4       5
</pre>

</ul>
<li>
  Start-of-Frame Packets
<pre>
            Field   PID     FrameNumber     CRC5
            Bits    8       11              5
</pre>

<li>
  Data Packets
<pre>
            Field   PID     DATA    CRC5
            Bits    8       0-8192  16
</pre>

<li>
  Handshake Packets
<pre>
            Field   PID
            Bits    8
</pre>

<ul>
<li>
 Handshake packets are used to report the status of a data transaction and can return values indicating successful reception of data, command acceptance or rejection, flow control, and halt conditions 

<li>
 Only transaction types that support flow control can return handshakes. There are four types of handshake packets and one special handshake packet:

<ul>
<li>
 ACK:  ACK can be returned by the host for IN transactions and by a function for OUT, SETUP, or PING transactions.

<li>
 NAK: The host can never issue NAK.

<li>
 STALL:  The host is not permitted to return a STALL under any condition.

<li>
 NYET: high-speed

<li>
 ERR: high-speed

</ul>
</ul>
</ul>
<li>
  Transactions    Spec 8.5

<ul>
<li>
  Bulk Transactions:

<li>
  Control Transfers:

<ul>
<li>
  Setup transaction

<li>
  Data transaction

<li>
  Status transaction

</ul>
<li>
  Interrupt Transactions:

<li>
  Isochronous Transactioins: Isochronous transactions have a token and data phase, but no handshake phase.

</ul>
</ul>

<h2 id="toc_0.2">Unknown</h2>
<ul>
<li>
  Split Transaction Special Token Packets

<li>
  Transactions

</ul>


   <hr />
   <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'rickhuang'; // required: replace example with your forum shortname

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</body>
</html>
