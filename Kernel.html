<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=cp936">
    <title>Kernel</title>
    <link rel="stylesheet" type="text/css" href="css/shCoreDefault.css"/>
    <link rel="Stylesheet" type="text/css" href="static/css/wiki.css">
    <link rel="Stylesheet" type="text/css" href="static/bootstrap/css/bootstrap.min.css">
    <script type="text/javascript" src="static/js/jquery.min.js"></script>
    <script type="text/javascript" src="static/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/js/wiki.js"></script>
    <script type="text/javascript" src="static/js/shCore.js"></script>
    <script type="text/javascript" src="static/js/shBrushPython.js"></script>
    <script type="text/javascript" src="static/js/shBrushCpp.js"></script>
    <script type="text/javascript" src="static/js/shBrushErlang.js"></script>
    <script type="text/javascript" src="static/js/shBrushBash.js"></script>
    <script type="text/javascript" src="static/js/shBrushRuby.js"></script>
    <script type="text/javascript" src="static/js/shBrushSql.js"></script>
    <script type="text/javascript" src="static/js/shBrushJScript.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<nav class="navbar navbar-default navbar-inverse" role="navigation">
 <div class="container">
    <div class="navbar-header">
<button data-target=".bs-navbar-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
	<span class="sr-only"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
      </button>
	<a class="navbar-brand" href="main.html">Rick's wiki</a>
    </div>
    <div class="collapse navbar-collapse">
	<ul class="nav navbar-nav">
	    <li><a href="main.html">Home</a></li>
	    <li><a href="TODO.html">TODO</a></li>
	</ul>
    </div>
 </div>
</nav>
<div class="container content-body">
    
<div class="toc">
<ul>
<li><a href="#toc_0.1">Basic</a>
<li><a href="#toc_0.2">Linux types</a>
<li><a href="#toc_0.3">Linux Log</a>
<li><a href="#toc_0.4">Linux Executive</a>
<li><a href="#toc_0.5">Linux IPC</a>
<li><a href="#toc_0.6">Linux memory</a>
<li><a href="#toc_0.7">Linux Driver Module</a>
<li><a href="#toc_0.8">Linux VFS</a>
<li><a href="#toc_0.9">Sysfs</a>
</ul>
<li><a href="#toc_1">Tools</a>
<li><a href="#toc_2">重要头文件 </a>
<li><a href="#toc_3">重要函数及宏</a>
</ul>
</div>

<h2 id="toc_0.1">Basic</h2>
<h2 id="toc_0.2"><a href="Linux types.html">Linux types</a></h2>
<h2 id="toc_0.3"><a href="Linux Log.html">Linux Log</a></h2>
<h2 id="toc_0.4"><a href="Linux Executive.html">Linux Executive</a></h2>
<h2 id="toc_0.5"><a href="Linux IPC.html">Linux IPC</a></h2>
<h2 id="toc_0.6"><a href="Linux memory.html">Linux memory</a></h2>
<h2 id="toc_0.7"><a href="Linux Driver Module.html">Linux Driver Module</a></h2>
<h2 id="toc_0.8"><a href="Linux VFS.html">Linux VFS</a></h2>
<h2 id="toc_0.9"><a href="Sysfs.html">Sysfs</a></h2>


<h1 id="toc_1">Tools</h1>
<table>
<tr>
<td>
strace
</td>
<td>
功能强大， 显示由用户空间程序所发出的所有系统调用， 不仅可以显示调用， 还能显示调用参数及用符号形式表示的返回值 
</td>
</tr>
<tr>
<td>
&nbsp;
</td>
<td>
&gt; strace ls /dev &gt; /dev/scull0
</td>
</tr>
<tr>
<td>
lockmeter
</td>
<td>
查看内核花费在锁上的时间， 确定锁竞争是否存在 
</td>
</tr>
<tr>
<td>
tree
</td>
<td>
显示目录树结构 
</td>
</tr>
</table>


<h1 id="toc_2">重要头文件 </h1>
<table>
<tr>
<td>
#include &lt;linux/init.h&gt;
</td>
<td>
包含模块初始化及清除函数的宏
</td>
<td>
module_init(init_function), module_exit(cleanup_function)
</td>
</tr>
<tr>
<td>
#include &lt;linux/sched.h&gt;
</td>
<td>
包含驱动程序使用的大部分内核API的定义 
</td>
<td>
Sleep()及各种变量声明 
</td>
</tr>
<tr>
<td>
#include &lt;linux/module.h&gt;
</td>
<td>
必需的头文件，必须包含在模块源代码中
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td>
#include &lt;linux/version.h&gt;
</td>
<td>
包含所构造内核版本信息的头文件 
</td>
<td>
LINUX_VERSION_CODE
</td>
</tr>
<tr>
<td>
#include &lt;linux/moduleparam.h&gt;
</td>
<td>
用来创建模块参数的宏所需头文件 
</td>
<td>
module_param(variable, type, perm);
</td>
</tr>
<tr>
<td>
#include &lt;linux/kernel.h&gt;
</td>
<td>
包含打印函数的头文件
</td>
<td>
printk(), container_of宏 
</td>
</tr>
<tr>
<td>
#include &lt;linux/types.h&gt;
</td>
<td>
包含一些变量声明 
</td>
<td>
dev_t 设备号类型 
</td>
</tr>
<tr>
<td>
#include &lt;linux/kdev_t.h&gt;
</td>
<td>
设备号相关宏操作
</td>
<td>
MAJOR(dev_t dev), MINOR(dev_t dev), MKDEV(int major, int minor)
</td>
</tr>
<tr>
<td>
#include &lt;linux/fs.h&gt;
</td>
<td>
文件系统相关操作
</td>
<td>
register_chrdev_region(), alloc_chrdev_region(), unregister_chrdev_region()
</td>
</tr>
<tr>
<td>
#include &lt;linux/slab.h&gt;
</td>
<td>
内存管理相关操作
</td>
<td>
kmalloc, kfree
</td>
</tr>
<tr>
<td>
#include &lt;linux/cdev.h&gt;
</td>
<td>
字符设备结构定义及函数操作 
</td>
<td>
struct cdev, cdev_init, cdev_add, cdev_alloc, cdev_del
</td>
</tr>
<tr>
<td>
#include &lt;asm/uaccess.h&gt;
</td>
<td>
声明在kernel和user mode移动数据函数
</td>
<td>
copy_from_user, copy_to_user
</td>
</tr>
<tr>
<td>
#include &lt;linux/proc_fs.h&gt;
</td>
<td>
所有使用/proc的模块必须包含 
</td>
<td>
其中的函数用于创建只读的/proc文件等 
</td>
</tr>
<tr>
<td>
#include &lt;asm/semaphore.h&gt;
</td>
<td>
Linux信号量 
</td>
<td>
struct semaphore;  sema_init();  DECLARE_MUTEX(name); down*(); up();
</td>
</tr>
<tr>
<td>
#include &lt;linux/rwsem.h&gt;
</td>
<td>
读入者/写入者信号量, rwsem
</td>
<td>
struct rw_semaphore;  init_rwsem; down*; up*; downgrade_write();
</td>
</tr>
<tr>
<td>
#include &lt;linux/completion.h&gt;
</td>
<td>
完成接口(completion), 同Windows中的Event
</td>
<td>
一种轻量级的机制， 允许一个线程告诉另一个线程某个工作已经完成 
</td>
</tr>
<tr>
<td>
#include &lt;linux/spinlock.h&gt;
</td>
<td>
自旋锁， spinlock
</td>
<td>
spinlock_t; spin_lock_init(); spin_lock*(); spin_unlock*();
</td>
</tr>
<tr>
<td>
#include &lt;linux/spinlock.h&gt;
</td>
<td>
读入者/写入者自旋锁
</td>
<td>
rwlock_t; rwlock_init(); read_lock*(); read_unlock*(); write_lock*()
</td>
</tr>
<tr>
<td>
#include &lt;linux/kfifo.h&gt;
</td>
<td>
内核中实现的通用的循环缓冲区
</td>
<td>
用于免锁的生产者/消费者任务的数据结构之一是循环缓冲区
</td>
</tr>
<tr>
<td>
#include &lt;asm/atomic&gt;
</td>
<td>
原子的整数类型， atomic_t
</td>
<td>
一个atomic_t变量在所有内核支持的架构上保存一个int值, 对该值的操作都是原子的 
</td>
</tr>
<tr>
<td>
#include &lt;asm/bitops.h&gt;
</td>
<td>
内核提供的一组可原子修改和测试单个位的函数 
</td>
<td>
set_bit; clear_bit; test_bit
</td>
</tr>
<tr>
<td>
#include &lt;linux/seqlock.h&gt;
</td>
<td>
提供对共享资源的快速、免锁访问, seqlock_t
</td>
<td>
当要保护的资源很小、很简单、会频繁读而且写入很少且快速时， 使用seqlock
</td>
</tr>
<tr>
<td>
#include &lt;linux/rcupdate.h&gt;
</td>
<td>
读取-复制-更新（read-copy-update） 
</td>
<td>
针对经常发生读取而很少写入的情形做了优化
</td>
</tr>
<tr>
<td>
#include &lt;linux/jiffies.h&gt;
</td>
<td>
内核计数器及读取计数器工具 
</td>
<td>
jiffies（直接访问)， jiffies_64( get_jiffies_64()), 只读变量;
</td>
</tr>
<tr>
<td>
#include &lt;linux/time.h&gt;
</td>
<td>
时间操作函数
</td>
<td>
timespec_to_jiffies;jiffies_to_timespec;time_to_jiffies;jiffies_to_timeval
</td>
</tr>
<tr>
<td>
#include &lt;linux/wait.h&gt;
</td>
<td>
长延时操作， 超时
</td>
<td>
wait_event_timeout, wait_event_interruptble_timeout,
</td>
</tr>
<tr>
<td>
#include &lt;linux/delay.h
</td>
<td>
短延时, 平台相关，实际包含在&lt;asm.delay.h&gt;
</td>
<td>
ndelay(纳秒); udelay(微秒); mdelay(毫秒)
</td>
</tr>
<tr>
<td>
#include &lt;linux/timer.h
</td>
<td>
内核提供的声明、注册和删除内核定时器的函数
</td>
<td>
struct timer_list; init_timer; add_timer; del_timer
</td>
</tr>
<tr>
<td>
#include &lt;linux/interrupt.h&gt;
</td>
<td>
tasklet, 内核设施， 类似内核定时器 
</td>
<td>
struct tasklit_struct; tasklet_init;
</td>
</tr>
<tr>
<td>
#include &lt;linux/workqueue.h&gt;
</td>
<td>
工作队列， 类似于tasklet
</td>
<td>
struct workqueue_struct; create_workqueue; create_siglethread_workqueue
</td>
</tr>
<tr>
<td>
#include &lt;linux/slab.h&gt;
</td>
<td>
kernel态内存分配; 后备高速缓存(lookaside cache)
</td>
<td>
kmalloc(); kfree(); slab分配器实现的高速缓存具有kmem_cache_t类型
</td>
</tr>
<tr>
<td>
#include &lt;linux/malloc.h&gt;
</td>
<td>
slab高速缓存操作函数 
</td>
<td>
kmem_cache_create; kmem_cache_destroy; kmem_cache_alloc; kmem_cache_free
</td>
</tr>
<tr>
<td>
#include &lt;linux/gfp.h&gt;
</td>
<td>
GFP: get free pages, 包含kmalloc的flags定义
</td>
<td>
GPF_KERNEL; GPF_ATOMIC
</td>
</tr>
<tr>
<td>
#include &lt;linux/mempool.h&gt;
</td>
<td>
内存池对象， mempool_t类型
</td>
<td>
mempool_create; mempool_alloc; mempool_free; mempool_destroy
</td>
</tr>
<tr>
<td>
#include &lt;linux/vmalloc.h&gt;
</td>
<td>
分配虚拟地址空间的连续区域 
</td>
<td>
vmalloc; vfree; ioremap; iounmap;
</td>
</tr>
<tr>
<td>
#include &lt;linux/types.h&gt;
</td>
<td>
包含&lt;asm/types.h&gt;, 定义确定空间大小的数据类型 
</td>
<td>
linux特有的类型： u8, u16, u32, u32
</td>
</tr>
<tr>
<td>
#include &lt;linux/byteorder&gt;
</td>
<td>
byteorder下文件：big_endian.h, little_endian.h
</td>
<td>
宏定义：可在处理器字节序与特殊字节序转换
</td>
</tr>
<tr>
<td>
#include &lt;linux/list.h&gt;
</td>
<td>
内核中的链表机制
</td>
<td>
list_head; INIT_LIST_HEAD(); list_for_each(); list_for_each_safe()
</td>
</tr>
<tr>
<td>
#include &lt;linux/kobject.h&gt;
</td>
<td>
kobject， 设备模型的基本结构, 可嵌入(同list)
</td>
<td>
kobject_init(); kobject_get(); kobject_put()
</td>
</tr>
<tr>
<td>
#include &lt;linux/device.h&gt;
</td>
<td>
linux设备模型相关类型及函数定义 
</td>
<td>
bus_type结构表示总线
</td>
</tr>
<tr>
<td>
#include &lt;dache.h&gt;
</td>
<td>
内核提供对dentry对象处理的辅助函数 
</td>
<td>
dput, dget, d_drop, d_alloc, d_add
</td>
</tr>
</table>

<h1 id="toc_3">重要函数及宏</h1>
<table>
<tr>
<td>
container_of
</td>
<td>
&lt;linux/kernel.h&gt;
</td>
<td>
宏， 由结构中成员的指针获得结构的指针
</td>
</tr>
<tr>
<td>
mutex_lock_interuptible
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td>
mutex_unlock
</td>
<td>
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
</table>


   <hr />
   <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'rickhuang'; // required: replace example with your forum shortname

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</body>
</html>
